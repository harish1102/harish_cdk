trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
- script: |
    echo "Assuming AWS Role..."
    AWS_ASSUME_ROLE_OUTPUT=$(aws sts assume-role --role-arn $(AWSRoleARN) --role-session-name AzureDevOpsSession)
    export AWS_ACCESS_KEY_ID=$(echo $AWS_ASSUME_ROLE_OUTPUT | jq -r '.Credentials.AccessKeyId')
    export AWS_SECRET_ACCESS_KEY=$(echo $AWS_ASSUME_ROLE_OUTPUT | jq -r '.Credentials.SecretAccessKey')
    export AWS_SESSION_TOKEN=$(echo $AWS_ASSUME_ROLE_OUTPUT | jq -r '.Credentials.SessionToken')
    echo "Configured AWS CLI with assumed role credentials"
  displayName: 'Assume AWS Role'
  env:
    AWSRoleARN: $(AWSRoleARN)
    AWS_ACCESS_KEY_ID: $(AWSAccessKeyID)
    AWS_SECRET_ACCESS_KEY: $(AWSSecretAccessKey)
-------------
